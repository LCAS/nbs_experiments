<?xml version="1.0" encoding="UTF-8"?>


<launch>

    <arg name="state"          default="localization"/>
    <arg name="loc_map_yaml"   default="$(env HOME)/.pal/maps/configurations/INB3123/map.yaml"/>
    <arg name="nav_map_yaml"   default="$(env HOME)/.pal/maps/configurations/INB3123_mcdm/map.yaml"/>
    <arg name="map_2_loc_map_pose"   default="0.0 0.0 0.0 0.0 0.0 0.0 1.0"/>

    <arg name="localization"   default="amcl"/>
    <arg name="mapping"        default="gmapping"/>
    <arg name="octomap"        default="false"/>
    <arg name="multiple"       default="false"/>
    <arg name="tf_prefix"      default=""/>
    <arg name="public_sim"     default="true"/>

    <arg name="planner"        default="base"/>
    <arg name="global_planner" default="global_planner"/>
    
    <!-- Available local planners: dwa/eband/pal/robotino/trajectory 
	 Available also in sim: dwa/eband/robotino/trajectory
    -->
    <arg name="local_planner"  default="eband"/>

    <!-- Localization -->
    <node name="loc_map_server" pkg="map_server" type="map_server" args="$(arg loc_map_yaml)"  output="screen">
        <remap from="map" to ="loc_map"/>
        <param name="frame_id" value="loc_map"/>
    </node>

    <node pkg="amcl" type="amcl" name="amcl" output="screen">
        <remap from="map" to="loc_map"/>
        <rosparam file="$(env HOME)/.pal/pose.yaml" command="load"/>
        <!-- Same yaml in a different packaga in sim -->
        <rosparam file="$(find tiago_2dnav)/config/localization/amcl.yaml" command="load"/>
        <rosparam param="global_frame_id" subst_value="True">loc_map</rosparam>
        <rosparam param="gui_publish_rate" subst_value="True">30</rosparam>
        <param name="use_map_topic" value="true"/>
        <param name="first_map_only" value="true"/>
    </node>

    <!-- Navigation -->
    <node name="nav_map_server" pkg="map_server" type="map_server" args="$(arg nav_map_yaml)"  output="screen">
    </node>

    <node pkg="tf" type="static_transform_publisher" name="map_2_loc_map_tfb"
        args="$(arg map_2_loc_map_pose) map loc_map 1000"/>

    <include file="$(find tiago_2dnav)/launch/state_machine.launch">
        <arg name="state" value="$(arg state)"/>
        <arg name="public_sim" value="true"/>
    </include>

    <!-- Planning -->
    <include file="$(find tiago_2dnav)/launch/move_$(arg planner).launch">
        <arg name="global_planner" value="$(arg global_planner)"/>
        <arg name="local_planner"  value="$(arg local_planner)"/>
        <arg name="public_sim"     value="true"/>
        <!-- rgbd_sensors arg is only present in simulation  -->
	<!-- arg name="rgbd_sensors"   value="false"/-->
        <arg name="tf_prefix"      value="$(arg tf_prefix)"/>
        <arg name="multiple"       value="$(arg multiple)"/>
    </include>

    <!-- 
         Change map parameter:
         Inflation radius of 0.1 was insuficient in real robot
    -->
    <rosparam param="/move_base/global_costmap/inflation_layer/inflation_radius" subst_value="True">0.2</rosparam>
    <rosparam param="/move_base/local_costmap/inflation_layer/inflation_radius" subst_value="True">0.2</rosparam>



</launch>
