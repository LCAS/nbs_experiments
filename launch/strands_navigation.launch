<?xml version="1.0"?>
<launch>
  <arg name="map"             default="$(find mcdm_experiments)/maps/inb3123/map_real_sci_mcdm/cropped.yaml"/>
  <arg name="loc_map_yaml"    default="$(find mcdm_experiments)/maps/inb3123/map_real_sci/cropped.yaml"/>
  <arg name="amcl_cfg"        default="$(find mcdm_experiments)/config/amcl_scitos_real.yaml"/>
  <arg name="move_base_cfg"        default="$(find mcdm_experiments)/config/move_base_scitos_real.yaml"/>
  <arg name="map_2_loc_map_pose"   default="0.0 0.0 0.0 0.0 0.0 0.0 1.0"/>

  <arg name="laser_angle_cutoff" default="10.0"/>


  <arg name="machine" default="localhost" />
  <arg name="user" default="" />
  <!-- NOW when launching in a remote mode it will need the ROS_ENV_LOADER set if not it will leave it empty -->
  <machine name="$(arg machine)" address="$(arg machine)" env-loader="$(optenv ROS_ENV_LOADER )" user="$(arg user)" default="true"/>

  <!-- This node removes the desired cutoff from the laser edges -->
  <node pkg="strands_movebase" type="remove_edges_laser" name="remove_edges_laser" output="screen">
      <param name="input" value="/scan"/>
      <param name="output" value="/move_base/scan_obstacle"/>
      <param name="cutoff_angle" value="$(arg laser_angle_cutoff)"/>
  </node>

  <!-- .......................... Localization ........................... -->
  <node name="loc_map_server" pkg="map_server" type="map_server" args="$(arg loc_map_yaml)"  output="screen">
      <remap from="map" to ="loc_map"/>
      <param name="frame_id" value="loc_map"/>
  </node>

  <node pkg="tf" type="static_transform_publisher" name="map_2_loc_map_tfb"
      args="$(arg map_2_loc_map_pose) map loc_map 1000"/>

  <node pkg="amcl" type="amcl" name="amcl" output="screen">
      <remap from="map" to="loc_map"/>
      <rosparam file="$(env HOME)/.ros/pose.yaml" command="load"/>
      <rosparam file="$(arg amcl_cfg)" command="load"/>
      <rosparam param="global_frame_id" subst_value="True">loc_map</rosparam>
      <rosparam param="gui_publish_rate" subst_value="True">30</rosparam>
      <param name="use_map_topic" value="true"/>
      <param name="first_map_only" value="true"/>
  </node>

  <!-- ............................ Navigation ........................... -->
  <node name="map_server" pkg="map_server" type="map_server" args="$(arg map)"/>

  <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen" clear_params="true">
      <remap from="/move_base/local_costmap/voxel_grid" to="/voxel_grid"/>
      <rosparam file="$(arg move_base_cfg)" command="load"/>
      <param name="local_costmap/obstacle_layer/publish_voxel_map" value="true"/>
  </node>


</launch>
