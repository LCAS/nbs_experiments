---
session: ncnr_robot
init_cmd: |
  #exec /bin/bash
  cd @TMULE_CONFIG_DIR@ || true
  set -o pipefail
  function export_default () {
    var_name="$1"
    var_default="$2"
    eval $var_name="${!var_name:-$var_default}"
    export $var_name
    echo "  $0 -> $var_name=${!var_name}"
  }

  # source ROS
  source "/opt/ros/$(rosversion -d)/setup.bash"

  export_default CATKIN_WORKSPACE "`readlink -f ../../../`"
  source "$CATKIN_WORKSPACE/devel/setup.bash"

  export_default LOC_MAP_YAML "$(rospack find gazebo_radiation_plugins)/maps/reactor_2.yaml"
  export_default LOG_PATH "/tmp/ncnr_topoNBS/nbs/"
  export_default LOOKUP_TABLE_DISTANCES "reactor_map.csv"

# tags: core, nav
windows:
- name: rad_gazebo
  tags: [base]
  panes:
  - roslaunch nbs_experiments radiation_demonstrator_ncnr.launch loc_map_yaml:=$LOC_MAP_YAML nav_map_yaml:=$LOC_MAP_YAML
  check: "rostopic list | grep gazebo"
- name: rad_map
  tags: [base]
  panes:
  - |
    conda activate krigin
    roslaunch ncnr_logging krigin.launch out_path:=$LOG_PATH
  check: "rosservice list | grep radiation_map"
- name: nbs
  tags: [base]
  panes:
  - rosrun topological_navigation get_simple_policy.py
  - roslaunch next_best_sense pure.launch dest_folder:=$LOG_PATH distances_map:=$LOOKUP_TABLE_DISTANCES
  check: "rostopic list | grep stats"